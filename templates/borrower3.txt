<?php
session_start();
error_reporting(0);
include('includes/config.php');
if(strlen($_SESSION['login'])==0)
  { 
header('location:login.php');
}else{

if(isset($_POST['submit']))
{
$type=$_POST['equipment_name'];
$description=$_POST['description'];
$date_added=$_POST['date_added'];
$date_updated=$_POST['date_updated'];
$category=$_POST['category'];
$quantity=$_POST['quantity'];
$status=1;
$sql= "INSERT INTO equipment (Type,Description,date_added,date_updated, Category, quantity, status) 
        VALUES(:type,:description,:date_added, :date_updated,:category,:quantity,:status)";

$query = $dbh->prepare($sql);
$query->bindParam(':type',$type,PDO::PARAM_STR);
$query->bindParam(':description',$description,PDO::PARAM_STR);
$query->bindParam(':date_added',$date_added,PDO::PARAM_STR);
$query->bindParam(':date_updated',$date_updated,PDO::PARAM_STR);
$query->bindParam(':category',$category,PDO::PARAM_STR);
$query->bindParam(':quantity',$quantity,PDO::PARAM_STR);
$query->bindParam(':status',$status,PDO::PARAM_STR);
$query->execute();
$lastInsertId = $dbh->lastInsertId();
if($lastInsertId)
{
echo "<script>alert('You successfully added an item!');</script>";
}
else 
{
echo "<script>alert('Something went wrong. Please try again');</script>";
}
}
?>

<!DOCTYPE html>
<html lang="en">

<?php include('templates/head.php');?>

<body id="page-top">

  <!-- Navbar Search -->
  <!-- Navbar -->
  <?php include('templates/navbar.php');?>   
  <!-- Sidebar -->
  <?php include('templates/sidebar.php');?>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="index.php">Dashboard</a>
          </li>
          <li class="breadcrumb-item active">Add Item</li>
        </ol>

        <!-- Page Content -->
        <!-- additem form grid -->
        <div class="mb-4">
        
        <div class="form-group mb-4">
          <h3 class="display-10">Add Item Page</h3>
        </div>
        
        <form method="post" name="submit" >
          <!--Grid row-->
          <!-- Itemcode input -->
            <!-- Item Name input -->
            <div class="form-group col-md-6">
              <label for="itemname">Item Name</label>
              <input type="text" name= "equipment_name" class="form-control" id="itemname" placeholder="Item Name">
            </div>
             <!-- Item Name input -->
            <div class="form-group col-md">
              <label for="itemname">Quantity</label>
              <input type="text" name= "quantity" class="form-control" id="itemname" placeholder="0">
            </div>
            <!--  Category input -->
            <div class="form-group col-md-2">
            <label for="inputCategory">Category</label>
              <select type="text" name= "category" class="form-control" id="inputCategory">
              <option disabled selected>Category</option>
              <option> Sports Equipment</option>
              <option> Gym Equipment </option>
              </select>
            </div>
          </div>
          <!--Grid row-->
          <!-- InputDescription input -->
          <div class="form-group col-md-14">
            <label for="InputDescription">Description</label>
            <textarea class="form-control" name="description" rows="5" id="InputDescription" resize="none" placeholder="Description Here"></textarea>
          </div>

          <!-- Grid row  Buttons -->          
          <div class="btn-group">
            <button type="submit"  name="submit"  value="Submit"  class="btn btn-primary btn-lg">Add item</button>
            <button type="clear" class="btn btn-primary btn-lg">Clear</button>
          </div>
        
        </form>
        </div>

        <!-- DataTables Example -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            Items Table</div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                  <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Category</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th>Item Code</th>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Category</th>
                    <th>Description</th>
                  </tr>
                </tfoot>
                <tbody>

                <?php $sql = "SELECT * from  equipment ";
                      $query = $dbh -> prepare($sql);
                        $query->execute();
                        $results=$query->fetchAll(PDO::FETCH_OBJ);
                        $cnt=1;
                    if($query->rowCount() > 0)
                      {
                        foreach($results as $result)
                      {				
                        ?>


                  <tr>
                  <td><?php echo htmlentities($cnt);?></td>
                  <td><?php echo htmlentities($result->type);?></td>
                  <td><?php echo htmlentities($result->quantity);?></td>
                  <td><?php echo htmlentities($result->Category);?></td>
                  <td><?php echo htmlentities($result->Description);?></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>

    </div><!-- /.container-fluid -->
  </div><!-- /.content-wrapper -->
  <!--Footer-->    
  <?php include('templates/footer.php');?>
  </div><!-- /#wrapper -->
  <!--scrolltop-->
  <?php include('templates/scrolltop.php')?>
  
  <!--scripts-->
  <?php include('templates/scripts.php')?>

</body>

</html>
<?php} ?>